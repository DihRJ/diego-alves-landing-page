<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Painel Administrativo</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f7f7f7;
}
h2 {
    margin-top: 2rem;
}
form {
    background: #fff;
    padding: 1rem 2rem;
    margin-bottom: 2rem;
    border-radius: 8px;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
}
label {
    display: block;
    margin-top: 0.5rem;
}
input, textarea, select {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.25rem;
}
button {
    margin-top: 1rem;
    padding: 0.5rem 1rem;
}
#message {
    padding: 1rem;
    color: #fff;
    margin-bottom: 1rem;
    border-radius: 5px;
    display:none;
}
#message.success {
    background: #4CAF50;
}
#message.error {
    background: #f44336;
}
</style>
</head>
<body>
<h1>Painel Administrativo</h1>

<div id="message"></div>

<h2>Login do administrador</h2>
<form id="login-form">
    <label for="login-username">Usuário:</label>
    <input type="text" id="login-username" name="username" required>
    <label for="login-password">Senha:</label>
    <input type="password" id="login-password" name="password" required>
    <button type="submit">Entrar</button>
</form>

<h2>Trocar Senha</h2>
<form id="change-password-form">
    <label for="old-password">Senha atual:</label>
    <input type="password" id="old-password" name="old_password" required>
    <label for="new-password">Nova senha:</label>
    <input type="password" id="new-password" name="new_password" required>
    <button type="submit">Alterar senha</button>
</form>

<h2>Cadastrar Usuário</h2>
<form id="create-user-form">
    <label for="new-username">Usuário:</label>
    <input type="text" id="new-username" name="username" required>
    <label for="new-email">Email:</label>
    <input type="email" id="new-email" name="email" required>
    <label for="new-user-password">Senha:</label>
    <input type="password" id="new-user-password" name="password" required>
    <button type="submit">Criar usuário</button>
</form>

<h2>Adicionar link de portfólio</h2>
<form id="add-portfolio-form">
    <label for="portfolio-title">Título:</label>
    <input type="text" id="portfolio-title" name="title" required>
    <label for="portfolio-url">URL:</label>
    <input type="url" id="portfolio-url" name="url" required>
    <textarea id="portfolio-description" name="description" placeholder="Descrição (opcional)"></textarea>
    <button type="submit">Adicionar link</button>
</form>

<h2>Enviar PDF para portfólio</h2>
<form id="upload-pdf-form" enctype="multipart/form-data">
    <label for="pdf-link-id">ID do link:</label>
    <input type="number" id="pdf-link-id" name="link_id" required min="1">
    <label for="pdf-file">Selecione o arquivo PDF:</label>
    <input type="file" id="pdf-file" name="file" accept="application/pdf" required>
    <button type="submit">Enviar PDF</button>
</form>

<script>
function showMessage(text, type = 'success') {
    const msgDiv = document.getElementById('message');
    msgDiv.textContent = text;
    msgDiv.className = type === 'success' ? 'success' : 'error';
    msgDiv.style.display = 'block';
    setTimeout(() => { msgDiv.style.display = 'none'; }, 5000);
}

async function handleResponse(resp) {
    const data = await resp.json().catch(() => null);
    if (resp.ok) {
        if (data && data.message) {
            showMessage(data.message, 'success');
        } else {
            showMessage('Operação realizada com sucesso', 'success');
        }
    } else {
        const err = data && (data.error || data.message) ? (data.error || data.message) : 'Erro ao processar solicitação';
        showMessage(err, 'error');
    }
}

document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;
    const resp = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        credentials: 'include',
        body: JSON.stringify({ username, password })
    });
    await handleResponse(resp);
});

document.getElementById('change-password-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const old_password = document.getElementById('old-password').value;
    const new_password = document.getElementById('new-password').value;
    const resp = await fetch('/api/auth/change-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ old_password, new_password })
    });
    await handleResponse(resp);
});

document.getElementById('create-user-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('new-username').value;
    const email = document.getElementById('new-email').value;
    const password = document.getElementById('new-user-password').value;
    const resp = await fetch('/api/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ username, email, password })
    });
    await handleResponse(resp);
});

document.getElementById('add-portfolio-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const title = document.getElementById('portfolio-title').value;
    const url = document.getElementById('portfolio-url').value;
    const description = document.getElementById('portfolio-description').value;
    const body = description ? { title, url, description } : { title, url };
    const resp = await fetch('/api/portfolio/links', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify(body)
    });
    await handleResponse(resp);
});

document.getElementById('upload-pdf-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const linkId = document.getElementById('pdf-link-id').value;
    const file = document.getElementById('pdf-file').files[0];
    const formData = new FormData();
    formData.append('file', file);
    const resp = await fetch('/api/portfolio/links/' + linkId + '/upload-pdf', {
        method: 'POST',
        credentials: 'include',
        body: formData
    });
    await handleResponse(resp);
});
</script>

</body>
</html>
